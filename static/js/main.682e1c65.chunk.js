(this["webpackJsonpvirtual-background"]=this["webpackJsonpvirtual-background"]||[]).push([[0],[function(e,r,t){e.exports=t(1)},function(e,r,t){var n=function(e){"use strict";var r,t=Object.prototype,n=t.hasOwnProperty,o="function"===typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",i=o.asyncIterator||"@@asyncIterator",u=o.toStringTag||"@@toStringTag";function c(e,r,t){return Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}),e[r]}try{c({},"")}catch(S){c=function(e,r,t){return e[r]=t}}function f(e,r,t,n){var o=r&&r.prototype instanceof v?r:v,a=Object.create(o.prototype),i=new U(n||[]);return a._invoke=function(e,r,t){var n=l;return function(o,a){if(n===d)throw new Error("Generator is already running");if(n===m){if("throw"===o)throw a;return L()}for(t.method=o,t.arg=a;;){var i=t.delegate;if(i){var u=b(i,t);if(u){if(u===h)continue;return u}}if("next"===t.method)t.sent=t._sent=t.arg;else if("throw"===t.method){if(n===l)throw n=m,t.arg;t.dispatchException(t.arg)}else"return"===t.method&&t.abrupt("return",t.arg);n=d;var c=s(e,r,t);if("normal"===c.type){if(n=t.done?m:p,c.arg===h)continue;return{value:c.arg,done:t.done}}"throw"===c.type&&(n=m,t.method="throw",t.arg=c.arg)}}}(e,t,i),a}function s(e,r,t){try{return{type:"normal",arg:e.call(r,t)}}catch(S){return{type:"throw",arg:S}}}e.wrap=f;var l="suspendedStart",p="suspendedYield",d="executing",m="completed",h={};function v(){}function g(){}function E(){}var _={};_[a]=function(){return this};var T=Object.getPrototypeOf,x=T&&T(T(C([])));x&&x!==t&&n.call(x,a)&&(_=x);var R=E.prototype=v.prototype=Object.create(_);function y(e){["next","throw","return"].forEach((function(r){c(e,r,(function(e){return this._invoke(r,e)}))}))}function F(e,r){function t(o,a,i,u){var c=s(e[o],e,a);if("throw"!==c.type){var f=c.arg,l=f.value;return l&&"object"===typeof l&&n.call(l,"__await")?r.resolve(l.__await).then((function(e){t("next",e,i,u)}),(function(e){t("throw",e,i,u)})):r.resolve(l).then((function(e){f.value=e,i(f)}),(function(e){return t("throw",e,i,u)}))}u(c.arg)}var o;this._invoke=function(e,n){function a(){return new r((function(r,o){t(e,n,r,o)}))}return o=o?o.then(a,a):a()}}function b(e,t){var n=e.iterator[t.method];if(n===r){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=r,b(e,t),"throw"===t.method))return h;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return h}var o=s(n,e.iterator,t.arg);if("throw"===o.type)return t.method="throw",t.arg=o.arg,t.delegate=null,h;var a=o.arg;return a?a.done?(t[e.resultName]=a.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=r),t.delegate=null,h):a:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,h)}function A(e){var r={tryLoc:e[0]};1 in e&&(r.catchLoc=e[1]),2 in e&&(r.finallyLoc=e[2],r.afterLoc=e[3]),this.tryEntries.push(r)}function w(e){var r=e.completion||{};r.type="normal",delete r.arg,e.completion=r}function U(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(A,this),this.reset(!0)}function C(e){if(e){var t=e[a];if(t)return t.call(e);if("function"===typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function t(){for(;++o<e.length;)if(n.call(e,o))return t.value=e[o],t.done=!1,t;return t.value=r,t.done=!0,t};return i.next=i}}return{next:L}}function L(){return{value:r,done:!0}}return g.prototype=R.constructor=E,E.constructor=g,g.displayName=c(E,u,"GeneratorFunction"),e.isGeneratorFunction=function(e){var r="function"===typeof e&&e.constructor;return!!r&&(r===g||"GeneratorFunction"===(r.displayName||r.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,E):(e.__proto__=E,c(e,u,"GeneratorFunction")),e.prototype=Object.create(R),e},e.awrap=function(e){return{__await:e}},y(F.prototype),F.prototype[i]=function(){return this},e.AsyncIterator=F,e.async=function(r,t,n,o,a){void 0===a&&(a=Promise);var i=new F(f(r,t,n,o),a);return e.isGeneratorFunction(t)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},y(R),c(R,u,"Generator"),R[a]=function(){return this},R.toString=function(){return"[object Generator]"},e.keys=function(e){var r=[];for(var t in e)r.push(t);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=C,U.prototype={constructor:U,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=r,this.done=!1,this.delegate=null,this.method="next",this.arg=r,this.tryEntries.forEach(w),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=r)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function o(n,o){return u.type="throw",u.arg=e,t.next=n,o&&(t.method="next",t.arg=r),!!o}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],u=i.completion;if("root"===i.tryLoc)return o("end");if(i.tryLoc<=this.prev){var c=n.call(i,"catchLoc"),f=n.call(i,"finallyLoc");if(c&&f){if(this.prev<i.catchLoc)return o(i.catchLoc,!0);if(this.prev<i.finallyLoc)return o(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return o(i.catchLoc,!0)}else{if(!f)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return o(i.finallyLoc)}}}},abrupt:function(e,r){for(var t=this.tryEntries.length-1;t>=0;--t){var o=this.tryEntries[t];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=r&&r<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=r,a?(this.method="next",this.next=a.finallyLoc,h):this.complete(i)},complete:function(e,r){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&r&&(this.next=r),h},finish:function(e){for(var r=this.tryEntries.length-1;r>=0;--r){var t=this.tryEntries[r];if(t.finallyLoc===e)return this.complete(t.completion,t.afterLoc),w(t),h}},catch:function(e){for(var r=this.tryEntries.length-1;r>=0;--r){var t=this.tryEntries[r];if(t.tryLoc===e){var n=t.completion;if("throw"===n.type){var o=n.arg;w(t)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:C(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=r),h}},e}(e.exports);try{regeneratorRuntime=n}catch(o){Function("r","regeneratorRuntime = r")(n)}},function(e,r,t){"use strict";t.r(r);var n=t(0),o=t.n(n);function a(e,r,t,n,o,a,i){try{var u=e[a](i),c=u.value}catch(f){return void t(f)}u.done?r(c):Promise.resolve(c).then(n,o)}function i(e){return function(){var r=this,t=arguments;return new Promise((function(n,o){var i=e.apply(r,t);function u(e){a(i,n,o,u,c,"next",e)}function c(e){a(i,n,o,u,c,"throw",e)}u(void 0)}))}}function u(e,r){(null==r||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function c(e,r){return function(e){if(Array.isArray(e))return e}(e)||function(e,r){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(e)){var t=[],n=!0,o=!1,a=void 0;try{for(var i,u=e[Symbol.iterator]();!(n=(i=u.next()).done)&&(t.push(i.value),!r||t.length!==r);n=!0);}catch(c){o=!0,a=c}finally{try{n||null==u.return||u.return()}finally{if(o)throw a}}return t}}(e,r)||function(e,r){if(e){if("string"===typeof e)return u(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?u(e,r):void 0}}(e,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function f(e,r){return r||(r=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(r)}}))}var s={"256x144":[256,144],"160x96":[160,96]};var l,p,d,m,h,v,g,E=String.raw;function _(e,r,t,n,o){var a=function(e,r,t){var n=e.createProgram();if(e.attachShader(n,r),e.attachShader(n,t),e.linkProgram(n),!e.getProgramParameter(n,e.LINK_STATUS))throw new Error("Could not link WebGL program: ".concat(e.getProgramInfoLog(n)));return n}(e,r,t),i=e.getAttribLocation(a,"a_position");e.enableVertexAttribArray(i),e.bindBuffer(e.ARRAY_BUFFER,n),e.vertexAttribPointer(i,2,e.FLOAT,!1,0,0);var u=e.getAttribLocation(a,"a_texCoord");return e.enableVertexAttribArray(u),e.bindBuffer(e.ARRAY_BUFFER,o),e.vertexAttribPointer(u,2,e.FLOAT,!1,0,0),a}function T(e,r,t){var n=e.createShader(r);if(e.shaderSource(n,t),e.compileShader(n),!e.getShaderParameter(n,e.COMPILE_STATUS))throw new Error("Could not compile shader: ".concat(e.getShaderInfoLog(n)));return n}function x(e,r,t,n){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:e.NEAREST,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:e.NEAREST,i=e.createTexture();return e.bindTexture(e.TEXTURE_2D,i),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,o),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,a),e.texStorage2D(e.TEXTURE_2D,1,r,t,n),i}function R(){return(R=i(o.a.mark((function e(r,t,n,a,i,u,c,f){var s;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=r.createBuffer(),r.bindBuffer(r.PIXEL_PACK_BUFFER,s),r.bufferData(r.PIXEL_PACK_BUFFER,f.byteLength,r.STREAM_READ),r.readPixels(t,n,a,i,u,c,0),r.bindBuffer(r.PIXEL_PACK_BUFFER,null),e.next=7,y(r,r.PIXEL_PACK_BUFFER,s,0,f);case 7:return r.deleteBuffer(s),e.abrupt("return",f);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function y(e,r,t,n,o,a,i){return F.apply(this,arguments)}function F(){return(F=i(o.a.mark((function e(r,t,n,a,i,u,c){var f,s;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return f=r.fenceSync(r.SYNC_GPU_COMMANDS_COMPLETE,0),r.flush(),e.next=4,b(r,f);case 4:s=e.sent,r.deleteSync(f),s!==r.WAIT_FAILED&&(r.bindBuffer(t,n),r.getBufferSubData(t,a,i,u,c),r.bindBuffer(t,null));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function b(e,r){return new Promise((function(t){requestAnimationFrame((function n(){var o=e.clientWaitSync(r,0,0);o!==e.WAIT_FAILED?o!==e.TIMEOUT_EXPIRED?t(o):requestAnimationFrame(n):t(o)}))}))}function A(e,r,t,n,o,a){var i=function(e,r,t,n,o,a){var i=E(l||(l=f(["#version 300 es\n\n    precision highp float;\n\n    uniform sampler2D u_inputFrame;\n    uniform sampler2D u_personMask;\n    uniform vec2 u_texelSize;\n\n    in vec2 v_texCoord;\n\n    out vec4 outColor;\n\n    const float offset[5] = float[](0.0, 1.0, 2.0, 3.0, 4.0);\n    const float weight[5] = float[](0.2270270270, 0.1945945946, 0.1216216216,\n      0.0540540541, 0.0162162162);\n\n    void main() {\n      vec4 centerColor = texture(u_inputFrame, v_texCoord);\n      float personMask = texture(u_personMask, v_texCoord).a;\n\n      vec4 frameColor = centerColor * weight[0] * (1.0 - personMask);\n\n      for (int i = 1; i < 5; i++) {\n        vec2 offset = vec2(offset[i]) * u_texelSize;\n\n        vec2 texCoord = v_texCoord + offset;\n        frameColor += texture(u_inputFrame, texCoord) * weight[i] *\n          (1.0 - texture(u_personMask, texCoord).a);\n\n        texCoord = v_texCoord - offset;\n        frameColor += texture(u_inputFrame, texCoord) * weight[i] *\n          (1.0 - texture(u_personMask, texCoord).a);\n      }\n      outColor = vec4(frameColor.rgb + (1.0 - frameColor.a) * centerColor.rgb, 1.0);\n    }\n  "]))),u=.4,c=a.width*u,s=a.height*u,p=1/c,d=1/s,m=T(e,e.FRAGMENT_SHADER,i),h=_(e,r,m,t,n),v=e.getUniformLocation(h,"u_inputFrame"),g=e.getUniformLocation(h,"u_personMask"),R=e.getUniformLocation(h,"u_texelSize"),y=x(e,e.RGBA8,c,s,e.NEAREST,e.LINEAR),F=x(e,e.RGBA8,c,s,e.NEAREST,e.LINEAR),b=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,b),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,y,0);var A=e.createFramebuffer();function w(){e.viewport(0,0,c,s),e.useProgram(h),e.uniform1i(v,0),e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,o);for(var r=0;r<3;r++)e.uniform2f(R,0,d),e.bindFramebuffer(e.FRAMEBUFFER,b),e.drawArrays(e.TRIANGLE_STRIP,0,4),e.activeTexture(e.TEXTURE2),e.bindTexture(e.TEXTURE_2D,y),e.uniform1i(v,2),e.uniform2f(R,p,0),e.bindFramebuffer(e.FRAMEBUFFER,A),e.drawArrays(e.TRIANGLE_STRIP,0,4),e.bindTexture(e.TEXTURE_2D,F)}function U(){e.deleteFramebuffer(A),e.deleteFramebuffer(b),e.deleteTexture(F),e.deleteTexture(y),e.deleteProgram(h),e.deleteShader(m)}return e.bindFramebuffer(e.FRAMEBUFFER,A),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,F,0),e.useProgram(h),e.uniform1i(g,1),{render:w,cleanUp:U}}(e,r,t,n,o,a),u=function(e,r,t,n){var o=E(p||(p=f(["#version 300 es\n\n    in vec2 a_position;\n    in vec2 a_texCoord;\n\n    out vec2 v_texCoord;\n\n    void main() {\n      // Flipping Y is required when rendering to canvas\n      gl_Position = vec4(a_position * vec2(1.0, -1.0), 0.0, 1.0);\n      v_texCoord = a_texCoord;\n    }\n  "]))),a=E(d||(d=f(["#version 300 es\n\n    precision highp float;\n\n    uniform sampler2D u_inputFrame;\n    uniform sampler2D u_personMask;\n    uniform sampler2D u_blurredInputFrame;\n    uniform vec2 u_coverage;\n\n    in vec2 v_texCoord;\n\n    out vec4 outColor;\n\n    void main() {\n      vec3 color = texture(u_inputFrame, v_texCoord).rgb;\n      vec3 blurredColor = texture(u_blurredInputFrame, v_texCoord).rgb;\n      float personMask = texture(u_personMask, v_texCoord).a;\n      personMask = smoothstep(u_coverage.x, u_coverage.y, personMask);\n      outColor = vec4(mix(blurredColor, color, personMask), 1.0);\n    }\n  "]))),i=n.width,u=n.height,c=T(e,e.VERTEX_SHADER,o),s=T(e,e.FRAGMENT_SHADER,a),l=_(e,c,s,r,t),m=e.getUniformLocation(l,"u_inputFrame"),h=e.getUniformLocation(l,"u_personMask"),v=e.getUniformLocation(l,"u_blurredInputFrame"),g=e.getUniformLocation(l,"u_coverage");function x(){e.viewport(0,0,i,u),e.useProgram(l),e.bindFramebuffer(e.FRAMEBUFFER,null),e.drawArrays(e.TRIANGLE_STRIP,0,4)}function R(r){e.useProgram(l),e.uniform2f(g,r[0],r[1])}function y(){e.deleteProgram(l),e.deleteShader(s),e.deleteShader(c)}return e.useProgram(l),e.uniform1i(m,0),e.uniform1i(h,1),e.uniform1i(v,2),e.uniform2f(g,0,1),{render:x,updateCoverage:R,cleanUp:y}}(e,t,n,a);return{render:function(){i.render(),u.render()},updateCoverage:function(e){u.updateCoverage(e)},cleanUp:function(){u.cleanUp(),i.cleanUp()}}}function w(e,r,t,n,o,a){var i=E(h||(h=f(["#version 300 es\n\n    precision highp float;\n\n    uniform sampler2D u_inputFrame;\n\n    in vec2 v_texCoord;\n\n    out vec4 outColor;\n\n    void main() {\n      outColor = texture(u_inputFrame, v_texCoord);\n    }\n  "]))),u=a._getInputMemoryOffset()/4,l=c(s[o.inputResolution],2),p=l[0],d=l[1],m=p*d,v=T(e,e.FRAGMENT_SHADER,i),g=_(e,r,v,t,n),y=e.getUniformLocation(g,"u_inputFrame"),F=x(e,e.RGBA8,p,d),b=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,b),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,F,0);var A=new Uint8Array(4*m);return e.useProgram(g),e.uniform1i(y,0),{render:function(){e.viewport(0,0,p,d),e.useProgram(g),e.bindFramebuffer(e.FRAMEBUFFER,b),e.drawArrays(e.TRIANGLE_STRIP,0,4),function(e,r,t,n,o,a,i,u){R.apply(this,arguments)}(e,0,0,p,d,e.RGBA,e.UNSIGNED_BYTE,A);for(var r=0;r<m;r++){var t=u+3*r,n=4*r;a.HEAPF32[t]=A[n]/255,a.HEAPF32[t+1]=A[n+1]/255,a.HEAPF32[t+2]=A[n+2]/255}},cleanUp:function(){e.deleteFramebuffer(b),e.deleteTexture(F),e.deleteProgram(g),e.deleteShader(v)}}}function U(e,r,t,n,a,u){var l=E(g||(g=f(["#version 300 es\n\n    in vec2 a_position;\n    in vec2 a_texCoord;\n\n    out vec2 v_texCoord;\n\n    void main() {\n      gl_Position = vec4(a_position, 0.0, 1.0);\n      v_texCoord = a_texCoord;\n    }\n  "]))),p=e.videoWidth,d=e.videoHeight,h=null!==p&&void 0!==p?p:0,R=null!==d&&void 0!==d?d:0,y=c(s[t.inputResolution],2),F=y[0],b=y[1],U=n.getContext("webgl2"),C=T(U,U.VERTEX_SHADER,l),L=U.createVertexArray();U.bindVertexArray(L);var S=U.createBuffer();U.bindBuffer(U.ARRAY_BUFFER,S),U.bufferData(U.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,-1,1,1,1]),U.STATIC_DRAW);var P=U.createBuffer();U.bindBuffer(U.ARRAY_BUFFER,P),U.bufferData(U.ARRAY_BUFFER,new Float32Array([0,0,1,0,0,1,1,1]),U.STATIC_DRAW);var M=U.createTexture();U.bindTexture(U.TEXTURE_2D,M),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_WRAP_S,U.CLAMP_TO_EDGE),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_WRAP_T,U.CLAMP_TO_EDGE),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_MIN_FILTER,U.NEAREST),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_MAG_FILTER,U.NEAREST);var D=x(U,U.RGBA8,F,b),B=x(U,U.RGBA8,h,R),I=w(U,C,S,P,t,a),k=function(e,r,t,n,o,a,i){var u=E(v||(v=f(["#version 300 es\n\n    precision highp float;\n\n    uniform sampler2D u_inputSegmentation;\n\n    in vec2 v_texCoord;\n\n    out vec4 outColor;\n\n    void main() {\n      vec2 segmentation = texture(u_inputSegmentation, v_texCoord).rg;\n      float shift = max(segmentation.r, segmentation.g);\n      float backgroundExp = exp(segmentation.r - shift);\n      float personExp = exp(segmentation.g - shift);\n      outColor = vec4(vec3(0.0), personExp / (backgroundExp + personExp));\n    }\n  "]))),l=a._getOutputMemoryOffset()/4,p=c(s[o.inputResolution],2),d=p[0],m=p[1],h=T(e,e.FRAGMENT_SHADER,u),g=_(e,r,h,t,n),R=e.getUniformLocation(g,"u_inputSegmentation"),y=x(e,e.RG32F,d,m),F=e.createFramebuffer();return e.bindFramebuffer(e.FRAMEBUFFER,F),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,i,0),e.useProgram(g),e.uniform1i(R,1),{render:function(){e.viewport(0,0,d,m),e.useProgram(g),e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,y),e.texSubImage2D(e.TEXTURE_2D,0,0,0,d,m,e.RG,e.FLOAT,a.HEAPF32,l),e.bindFramebuffer(e.FRAMEBUFFER,F),e.drawArrays(e.TRIANGLE_STRIP,0,4)},cleanUp:function(){e.deleteFramebuffer(F),e.deleteTexture(y),e.deleteProgram(g),e.deleteShader(h)}}}(U,C,S,P,t,a,D),O=function(e,r,t,n,o,a,i,u){var l=E(m||(m=f(["#version 300 es\n\n    precision highp float;\n\n    uniform sampler2D u_inputFrame;\n    uniform sampler2D u_segmentationMask;\n    uniform vec2 u_texelSize;\n    uniform float u_step;\n    uniform float u_radius;\n    uniform float u_offset;\n    uniform float u_sigmaTexel;\n    uniform float u_sigmaColor;\n\n    in vec2 v_texCoord;\n\n    out vec4 outColor;\n\n    float gaussian(float x, float sigma) {\n      float coeff = -0.5 / (sigma * sigma * 4.0 + 1.0e-6);\n      return exp((x * x) * coeff);\n    }\n\n    void main() {\n      vec2 centerCoord = v_texCoord;\n      vec3 centerColor = texture(u_inputFrame, centerCoord).rgb;\n      float newVal = 0.0;\n\n      float spaceWeight = 0.0;\n      float colorWeight = 0.0;\n      float totalWeight = 0.0;\n\n      // Subsample kernel space.\n      for (float i = -u_radius + u_offset; i <= u_radius; i += u_step) {\n        for (float j = -u_radius + u_offset; j <= u_radius; j += u_step) {\n          vec2 shift = vec2(j, i) * u_texelSize;\n          vec2 coord = vec2(centerCoord + shift);\n          vec3 frameColor = texture(u_inputFrame, coord).rgb;\n          float outVal = texture(u_segmentationMask, coord).a;\n\n          spaceWeight = gaussian(distance(centerCoord, coord), u_sigmaTexel);\n          colorWeight = gaussian(distance(centerColor, frameColor), u_sigmaColor);\n          totalWeight += spaceWeight * colorWeight;\n\n          newVal += spaceWeight * colorWeight * outVal;\n        }\n      }\n      newVal /= totalWeight;\n\n      outColor = vec4(vec3(0.0), newVal);\n    }\n  "]))),p=c(s[a.inputResolution],2),d=p[0],h=p[1],v=u.width,g=u.height,x=1/v,R=1/g,y=T(e,e.FRAGMENT_SHADER,l),F=_(e,r,y,t,n),b=e.getUniformLocation(F,"u_inputFrame"),A=e.getUniformLocation(F,"u_segmentationMask"),w=e.getUniformLocation(F,"u_texelSize"),U=e.getUniformLocation(F,"u_step"),C=e.getUniformLocation(F,"u_radius"),L=e.getUniformLocation(F,"u_offset"),S=e.getUniformLocation(F,"u_sigmaTexel"),P=e.getUniformLocation(F,"u_sigmaColor"),M=e.createFramebuffer();function D(r){r*=Math.max(v/d,g/h);var t=Math.max(1,.66*Math.sqrt(r)),n=r,o=t>1?.5*t:0,a=Math.max(x,R)*r;e.useProgram(F),e.uniform1f(U,t),e.uniform1f(C,n),e.uniform1f(L,o),e.uniform1f(S,a)}function B(r){e.useProgram(F),e.uniform1f(P,r)}return e.bindFramebuffer(e.FRAMEBUFFER,M),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,i,0),e.useProgram(F),e.uniform1i(b,0),e.uniform1i(A,1),e.uniform2f(w,x,R),D(0),B(0),{render:function(){e.viewport(0,0,v,g),e.useProgram(F),e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,o),e.bindFramebuffer(e.FRAMEBUFFER,M),e.drawArrays(e.TRIANGLE_STRIP,0,4)},updateSigmaSpace:D,updateSigmaColor:B,cleanUp:function(){e.deleteFramebuffer(M),e.deleteProgram(F),e.deleteShader(y)}}}(U,C,S,P,D,t,B,n),X=A(U,C,S,P,B,n);function N(){return(N=i(o.a.mark((function r(){return o.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:U.clearColor(0,0,0,0),U.clear(U.COLOR_BUFFER_BIT),U.activeTexture(U.TEXTURE0),U.bindTexture(U.TEXTURE_2D,M),U.texImage2D(U.TEXTURE_2D,0,U.RGBA,U.RGBA,U.UNSIGNED_BYTE,e),U.bindVertexArray(L),I.render(),u(),a._runInference(),u(),k.render(),O.render(),X.render();case 13:case"end":return r.stop()}}),r)})))).apply(this,arguments)}return{render:function(){return N.apply(this,arguments)},updatePostProcessingConfig:function(e){O.updateSigmaSpace(e.jointBilateralFilter.sigmaSpace),O.updateSigmaColor(e.jointBilateralFilter.sigmaColor),X.updateCoverage(e.coverage)},cleanUp:function(){X.cleanUp(),O.cleanUp(),k.cleanUp(),I.cleanUp(),U.deleteTexture(B),U.deleteTexture(D),U.deleteTexture(M),U.deleteBuffer(P),U.deleteBuffer(S),U.deleteVertexArray(L),U.deleteShader(C)}}}var C=function(e,r,t,n,a){var u,c=0,f=[],s=0,l=0,p=0,d=0,m=[],h=U(e,0,n,r,a,(function(){var e=Date.now();m[p]=e-l,l=e,p++}));function v(){return g.apply(this,arguments)}function g(){return(g=i(o.a.mark((function e(){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return E(),e.prev=1,e.next=4,h.render();case 4:_(),u=requestAnimationFrame(v),e.next=13;break;case 8:throw e.prev=8,e.t0=e.catch(1),u&&cancelAnimationFrame(u),h.cleanUp(),e.t0;case 13:case"end":return e.stop()}}),e,null,[[1,8]])})))).apply(this,arguments)}function E(){l=Date.now()}function _(){var e=Date.now();m[p]=e-l,d++,e>=s+1e3&&(c=1e3*d/(e-s),f=m,s=e,d=0),p=0}return h.updatePostProcessingConfig({smoothSegmentationMask:!0,jointBilateralFilter:{sigmaSpace:1,sigmaColor:.1},coverage:[.5,.75],lightWrapping:.3,blendMode:"screen"}),v(),{webglPipeline:h,canvasOutput:r,fps:c,durations:f}};function L(){return S.apply(this,arguments)}function S(){return(S=i(o.a.mark((function e(){var r,t,n,a,u,c;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c=function(){return(c=i(o.a.mark((function e(){var t,n,a;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,fetch("https://volcomix.github.io/virtual-background/models/segm_lite_v681.tflite");case 4:return t=e.sent,e.next=7,t.arrayBuffer();case 7:n=e.sent,a=r._getModelBufferMemoryOffset(),r.HEAPU8.set(new Uint8Array(n),a),r._loadModel(n.byteLength);case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)},u=function(){return c.apply(this,arguments)},a=function(){return(a=i(o.a.mark((function e(){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,createTFLiteSIMDModule();case 3:r=e.sent,console.log("WOOT! We're using SIMD!"),e.next=14;break;case 7:return e.prev=7,e.t0=e.catch(0),t=!1,e.next=12,createTFLiteModule();case 12:r=e.sent,console.warn("Failed to create TFLite SIMD WebAssembly module.",e.t0);case 14:case"end":return e.stop()}}),e,null,[[0,7]])})))).apply(this,arguments)},n=function(){return a.apply(this,arguments)},t=!0,e.next=7,n();case 7:return e.next=9,u();case 9:return e.abrupt("return",{tflite:r,isSIMDSupported:t});case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var P=function(){var e=i(o.a.mark((function e(r,t){var n,a,i;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,L();case 2:n=e.sent,a=n.tflite,i=C(r,t,{type:"blur"},{model:"meet",backend:"wasm",inputResolution:"160x96",pipeline:"webgl2"},a),i.webglPipeline.render();case 8:case"end":return e.stop()}}),e)})));return function(r,t){return e.apply(this,arguments)}}(),M=function(e,r){return new Promise(function(){var t=i(o.a.mark((function t(n,a){var i;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return 640,480,i={video:{width:640,height:480,frameRate:{ideal:30,max:30}}},e.addEventListener("loadeddata",(function(){r.width=e.videoWidth,r.height=e.videoHeight,n()})),t.next=6,navigator.mediaDevices.getUserMedia(i);case 6:e.srcObject=t.sent;case 7:case"end":return t.stop()}}),t)})));return function(e,r){return t.apply(this,arguments)}}())};i(o.a.mark((function e(){var r,t;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=document.getElementById("input"),t=document.getElementById("output"),e.next=4,M(r,t);case 4:return e.next=6,P(r,t);case 6:case"end":return e.stop()}}),e)})))()}],[[2,1]]]);
//# sourceMappingURL=main.682e1c65.chunk.js.map